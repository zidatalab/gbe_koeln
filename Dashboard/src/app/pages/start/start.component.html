<div class="container" fxLayout="column" fxLayoutGap="1rem" fxLayoutAllign="space-around">
    <div>
        <p *ngIf="this.currentuser" class="mat-caption right">
            Angemeldet als <span> {{this.currentuser.anrede?this.currentuser.anrede+"
                "+this.currentuser.lastname:"" }}</span></p>
        <div class="brandingpicture" [ngClass]="{'smallheader': this.currentuser}">
            <h1>Kleinräumige GBE der Stadt Köln</h1>
        </div>
        <p *ngIf="!this.currentuser">
            Dieses Dashboard ist ein internes Informationsportal zur gesundheitlichen Lage der Bevölkerung Kölns. Bitte
            melden
            Sie sich an, um Zugriff auf die enthaltenen Informationen zu erhalten.</p>
        <p *ngIf="this.metadata.length==0 && !this.currentuser && !this.progress">
            Es sind aktuell keine öffentlichen Informationen auf diesem Portal verfügbar.
        </p>
        <p *ngIf="(this.metadata.length==0) && this.currentuser && !this.progress">
            Es sind keine Daten im System, bitte wenden Sie sich an einen Administrator.
        </p>
    </div>

    <div *ngIf="this.progress">
    <mat-spinner></mat-spinner>
    </div>

    <div *ngIf="this.metadata && !this.progress">
        <ng-container *ngIf="!(this.metadata.length>0 && this.levelvalues.length>0)">
            <mat-progress></mat-progress>
        </ng-container>
         <ng-container *ngIf="this.metadata.length>0 && this.levelvalues.length>0">
            <!-- <ng-container>
                <h3><strong>Subgruppen</strong></h3>
                <p>
                    <mat-chip-list>
                        <mat-chip-list>
                            <ng-container *ngFor="let item of this.subgroups">
                                <mat-chip (click)="this.setlevel('subgroups',item);"
                                    [disabled]="this.levelsettings['levelvalues']!=='Gesamt'"
                                    [selected]="(this.levelsettings['subgroups']==item)" color="primary">
                                    {{item}}
                                </mat-chip>
                            </ng-container>
                        </mat-chip-list>
                    </mat-chip-list>
                </p>
            </ng-container> -->
            <h1><strong>Indikatorauswahl</strong></h1>
            <h3>Typ</h3>
            <p>
            <mat-chip-list>
                <mat-chip-list>
                    <mat-chip (click)="this.outcomeart=item;" *ngFor="let item of ['Inanspruchnahme','M1Q','M2Q','Einflussfaktoren']"
                        [selected]="this.outcomeart==item" color="primary">
                        <span *ngIf="item=='M1Q'|| item=='M2Q'">Prävalenz </span>&nbsp; {{item}}</mat-chip>
                </mat-chip-list>
            </mat-chip-list>    
            </p>       
            <h3>Indikator</h3>
            <p fxHide=true fxShow.gt-sm=true>
                <ng-container *ngIf="this.outcomeart==='Inanspruchnahme'">
                <mat-chip-list>
                    <mat-chip-list>
                        <mat-chip (click)="this.setlevel('outcomes',item);" *ngFor="let item of this.outcomes_util"
                            [selected]="(this.levelsettings['outcomes']==item)" color="primary">
                            {{item.replace('Anteil Patienten mit','') | replace : '[_]' : '.'}}
                        </mat-chip>
                    </mat-chip-list>
                </mat-chip-list>
                </ng-container>
                <ng-container *ngIf="this.outcomeart==='M1Q'">
                    <mat-chip-list>
                        <mat-chip-list>
                            <mat-chip (click)="this.setlevel('outcomes',item);" *ngFor="let item of this.outcomes_m1q"
                                [selected]="(this.levelsettings['outcomes']==item)" color="primary">
                                {{item.replace(' M1Q','').replace('Prävalenz von','').replace('Prävalenz der','')  | replace : '[_]' : '.'  }}
                            </mat-chip>
                        </mat-chip-list>
                    </mat-chip-list>
                    </ng-container>
                    <ng-container *ngIf="this.outcomeart==='M2Q'">
                        <mat-chip-list>
                            <mat-chip-list>
                                <mat-chip (click)="this.setlevel('outcomes',item);" *ngFor="let item of this.outcomes_m2q"
                                    [selected]="(this.levelsettings['outcomes']==item)" color="primary">
                                    {{item.replace(' M2Q','').replace('Prävalenz von','').replace('Prävalenz der','')  | replace : '[_]' : '.'  }}
                                </mat-chip>
                            </mat-chip-list>
                        </mat-chip-list>
                        </ng-container>
                <ng-container *ngIf="this.outcomeart==='Einflussfaktoren'">
                    <mat-chip-list>
                        <mat-chip-list>
                            <mat-chip (click)="this.setlevel('outcomes',item);" *ngFor="let item of this.determinants"
                                [selected]="(this.levelsettings['outcomes']==item)" color="primary">
                                {{item.replace(' M2Q','').replace('Prävalenz von','').replace('Prävalenz der','')  | replace : '[_]' : '.'  }}
                            </mat-chip>
                        </mat-chip-list>
                    </mat-chip-list>
                    </ng-container>
            </p>            
        </ng-container>
    </div>
    <div *ngIf="this.data.length>0" fxLayout="column">
        
        <h1>Ergebnisse</h1>
        <h2><strong>Allgemeine Informationen</strong></h2>
        <div fxFlex=100 fxLayout="row wrap" fxLayoutGap="1rem">
            
            <div fxFlex=33>
                <mat-card class="mat-elevation-z0" ><p>Prävalenz</p></mat-card>
            </div>
            <div fxFlex >
                <mat-card  class="mat-elevation-z0"><p>Indikatorbeschreibung</p></mat-card>
            </div>
            <div fxFlex=100 >
                <mat-card  
                class="mat-elevation-z0"><p>Alter und Geschlecht</p></mat-card>
            </div>


        </div>
        
        <div>
        <h2><strong>Regionale Unterschiede</strong></h2>
        <h3><strong>Raumeinheit</strong></h3>
            <p>
                <mat-chip-list>
                    <mat-chip (click)="this.setlevel('levelvalues',item);" *ngFor="let item of this.levelvalues"
                        [selected]="(this.levelsettings['levelvalues']==item)" color="primary"
                        [disabled]="this.levelsettings['subgroups']!='Keine'">
                        {{item}}<span *ngIf="this.geojson_available.indexOf(item)>=0">
                            <mat-icon class="primarycolor flagicon">map</mat-icon>
                        </span>
                    </mat-chip>
                </mat-chip-list>
            </p>
        <h3><strong>Subgruppenauswahl</strong></h3>
        <p>
            Auswahl von Geschlecht, Altersgruppe und Alter
        </p>
        <div class="minheight"
            *ngIf="(this.geojson_available.indexOf(this.levelsettings['levelvalues'])>=0) && this.mapdata && this.data && this.levelid">
            <mat-card class="no-padding">
            <app-map *ngIf="this.mapdata['features'].length>0 && this.data.length>0" [containername]="'mapdiv'"
                [data]="this.data" [basemap]="this.mapdata" [bins]="5" [id]="this.levelid" opacity=.8 Zoom=10
                [colorscale]="['#2c7bb6','#abd9e9','#ffffbf','#fdae61','#D7191C']" [percent]="true" [feature]="this.levelsettings['outcomes']"></app-map>
            </mat-card>

        </div>
        <div class="minheight" *ngIf="this.levelsettings['levelvalues']!=='Gesamt' && this.data.length<100 ">
            <mat-card>
                <h2>Rangfolge der Regionen</h2>
                <app-plot [(data)]="this.data" [custommargins]="{ l: 0, r: 40, b: 150, t: 0 }" [xvalue]="this.levelid"
                    [percent]="true" [sort]="true" [outcomes]="[this.levelsettings['outcomes']]"
                    [colorscheme]="['#D7191C','#fdae61','#ffffbf','#abd9e9','#2c7bb6']" plottype="bar"></app-plot>
                </mat-card>
        </div>
        <div class="minheight" *ngIf="this.data">
            <mat-card>
                <h2>Regionssuche</h2>
                <app-table [data]="this.data" [columns]="this.datakeys" [addrank]="true" [outcomes_rate]="this.data_rate" [addfilter]="true"
                    [outcomes_numeric]="this.data_number"></app-table>
                </mat-card>
        </div>
    </div>
    </div>

</div>